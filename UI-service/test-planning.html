<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Planning Integration</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="dashboard-page">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-left">
        <img src="images/planeet-small.png" class="header-logo" alt="Planeet logo" style="height: 48px; width: auto;">
        <h1 class="dashboard-title">Test Planning Integration</h1>
      </div>
    </div>

    <!-- Test Button -->
    <div style="padding: 50px; text-align: center;">
      <button class="btn btn-primary" onclick="openPlanningForm()">
        <span class="icon">🚀</span> Test Planning Form
      </button>
    </div>
  </div>

  <!-- Planning Form Modal -->
  <div id="planningModal" class="planning-modal">
    <div class="planning-content">
      <div class="planning-header">
        <h2 class="planning-title">Create New Outing Plan</h2>
        <button class="close-btn" onclick="closePlanningForm()">×</button>
      </div>
      
      <form id="planningForm" class="planning-form">
        <!-- Basic Information -->
        <div class="form-section">
          <h3>Basic Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="planName">Plan Name *</label>
              <input class="input-field" id="planName" type="text" placeholder="e.g., Weekend in Tel Aviv" required />
            </div>
            <div class="form-group">
              <label for="groupSize">Group Size *</label>
              <input class="input-field" id="groupSize" type="number" min="1" max="20" placeholder="2" required />
            </div>
          </div>
        </div>

        <!-- Location -->
        <div class="form-section">
          <h3>Location</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="city">City *</label>
              <input class="input-field" id="city" type="text" placeholder="e.g., Tel Aviv" required />
            </div>
            <div class="form-group">
              <label for="address">Address (Optional)</label>
              <input class="input-field" id="address" type="text" placeholder="e.g., Rothschild Blvd" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="latitude">Latitude</label>
              <input class="input-field" id="latitude" type="number" step="0.000001" placeholder="32.0853" />
            </div>
            <div class="form-group">
              <label for="longitude">Longitude</label>
              <input class="input-field" id="longitude" type="number" step="0.000001" placeholder="34.7818" />
            </div>
          </div>
        </div>

        <!-- Date & Time -->
        <div class="form-section">
          <h3>Date & Time</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="planDate">Date *</label>
              <input class="input-field" id="planDate" type="date" required />
            </div>
            <div class="form-group">
              <label for="planTime">Time *</label>
              <input class="input-field" id="planTime" type="time" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="durationHours">Duration (Hours)</label>
              <input class="input-field" id="durationHours" type="number" min="0.5" max="24" step="0.5" placeholder="3" />
            </div>
          </div>
        </div>

        <!-- Venue Types -->
        <div class="form-section">
          <h3>Venue Types *</h3>
          <div class="venue-types-grid">
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="restaurant" />
              <span class="checkmark">🍽️ Restaurant</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="cafe" />
              <span class="checkmark">☕ Cafe</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="bar" />
              <span class="checkmark">🍺 Bar</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="museum" />
              <span class="checkmark">🏛️ Museum</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="theater" />
              <span class="checkmark">🎭 Theater</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="park" />
              <span class="checkmark">🌳 Park</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="shopping_center" />
              <span class="checkmark">🛍️ Shopping Center</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="venueTypes" value="sports_facility" />
              <span class="checkmark">🏃 Sports Facility</span>
            </label>
          </div>
        </div>

        <!-- Preferences -->
        <div class="form-section">
          <h3>Preferences</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="budgetRange">Budget Range</label>
              <select class="input-field" id="budgetRange">
                <option value="">Any Budget</option>
                <option value="$">$ - Inexpensive</option>
                <option value="$$">$$ - Moderate</option>
                <option value="$$$">$$$ - Expensive</option>
              </select>
            </div>
            <div class="form-group">
              <label for="minRating">Minimum Rating</label>
              <select class="input-field" id="minRating">
                <option value="">Any Rating</option>
                <option value="3.0">3.0+ Stars</option>
                <option value="3.5">3.5+ Stars</option>
                <option value="4.0">4.0+ Stars</option>
                <option value="4.5">4.5+ Stars</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="radiusKm">Search Radius (km)</label>
              <input class="input-field" id="radiusKm" type="number" min="0.5" max="50" step="0.5" value="5" />
            </div>
            <div class="form-group">
              <label for="maxVenues">Max Venues</label>
              <input class="input-field" id="maxVenues" type="number" min="1" max="20" value="5" />
            </div>
          </div>
        </div>

        <!-- Special Requirements -->
        <div class="form-section">
          <h3>Special Requirements</h3>
          <div class="form-group">
            <label for="dietaryRestrictions">Dietary Restrictions</label>
            <input class="input-field" id="dietaryRestrictions" type="text" placeholder="e.g., vegetarian, gluten-free" />
          </div>
          <div class="form-group">
            <label for="accessibilityNeeds">Accessibility Needs</label>
            <input class="input-field" id="accessibilityNeeds" type="text" placeholder="e.g., wheelchair accessible" />
          </div>
          <div class="form-group">
            <label for="amenities">Required Amenities</label>
            <input class="input-field" id="amenities" type="text" placeholder="e.g., wifi, parking, outdoor seating" />
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <span class="icon">🚀</span> Create Plan
          </button>
          <button type="button" class="btn btn-secondary" onclick="closePlanningForm()">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Mock user data for testing
    const mockUser = {
      id: 'test_user_123',
      username: 'Test User',
      email: 'test@example.com'
    };

    // Simple planning form handler for testing
    function openPlanningForm() {
      const modal = document.getElementById('planningModal');
      if (modal) {
        modal.classList.add('active');
        setupPlanningForm();
      }
    }

    function closePlanningForm() {
      const modal = document.getElementById('planningModal');
      if (modal) {
        modal.classList.remove('active');
      }
    }

    function setupPlanningForm() {
      // Set default date to tomorrow
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      const dateInput = document.getElementById('planDate');
      if (dateInput) {
        dateInput.value = tomorrow.toISOString().split('T')[0];
      }

      // Set default time to current time + 1 hour
      const timeInput = document.getElementById('planTime');
      if (timeInput) {
        const now = new Date();
        now.setHours(now.getHours() + 1);
        timeInput.value = now.toTimeString().slice(0, 5);
      }

      // Add form submit handler
      const form = document.getElementById('planningForm');
      if (form) {
        form.onsubmit = handlePlanningFormSubmit;
      }

      // Add city input handler for geocoding
      const cityInput = document.getElementById('city');
      if (cityInput) {
        cityInput.addEventListener('blur', () => handleCityInput(cityInput.value));
      }
    }

    async function handlePlanningFormSubmit(event) {
      event.preventDefault();
      
      try {
        // Show loading state
        const submitBtn = event.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<span class="icon">⏳</span> Creating Plan...';
        submitBtn.disabled = true;

        // Collect form data
        const formData = collectPlanningFormData();
        
        // Validate form data
        if (!validatePlanningFormData(formData)) {
          return;
        }

        // Show success message (for testing)
        alert(`Plan data collected successfully!\n\nPlan Name: ${formData.planName}\nCity: ${formData.city}\nVenue Types: ${formData.venueTypes.join(', ')}\nGroup Size: ${formData.groupSize}`);
        
        // Close modal
        closePlanningForm();
        
      } catch (error) {
        console.error('Error creating plan:', error);
        alert('Failed to create plan. Please try again.');
      } finally {
        // Reset button state
        const submitBtn = event.target.querySelector('button[type="submit"]');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }

    function collectPlanningFormData() {
      // Get selected venue types
      const venueTypeCheckboxes = document.querySelectorAll('input[name="venueTypes"]:checked');
      const venueTypes = Array.from(venueTypeCheckboxes).map(cb => cb.value);

      // Get form values
      const formData = {
        planName: document.getElementById('planName').value,
        groupSize: parseInt(document.getElementById('groupSize').value),
        city: document.getElementById('city').value,
        address: document.getElementById('address').value,
        latitude: parseFloat(document.getElementById('latitude').value) || null,
        longitude: parseFloat(document.getElementById('longitude').value) || null,
        planDate: document.getElementById('planDate').value,
        planTime: document.getElementById('planTime').value,
        durationHours: parseFloat(document.getElementById('durationHours').value) || null,
        venueTypes: venueTypes,
        budgetRange: document.getElementById('budgetRange').value || null,
        minRating: parseFloat(document.getElementById('minRating').value) || null,
        radiusKm: parseFloat(document.getElementById('radiusKm').value),
        maxVenues: parseInt(document.getElementById('maxVenues').value),
        dietaryRestrictions: document.getElementById('dietaryRestrictions').value || null,
        accessibilityNeeds: document.getElementById('accessibilityNeeds').value || null,
        amenities: document.getElementById('amenities').value || null
      };

      return formData;
    }

    function validatePlanningFormData(formData) {
      // Check required fields
      if (!formData.planName.trim()) {
        alert('Please enter a plan name.');
        return false;
      }

      if (!formData.city.trim()) {
        alert('Please enter a city.');
        return false;
      }

      if (formData.venueTypes.length === 0) {
        alert('Please select at least one venue type.');
        return false;
      }

      if (formData.groupSize < 1) {
        alert('Group size must be at least 1.');
        return false;
      }

      return true;
    }

    async function handleCityInput(cityName) {
      if (!cityName.trim()) return;

      try {
        // Try to get coordinates for the city
        const coordinates = await geocodeCity(cityName);
        if (coordinates) {
          document.getElementById('latitude').value = coordinates.lat;
          document.getElementById('longitude').value = coordinates.lng;
        }
      } catch (error) {
        console.log('Could not geocode city:', cityName);
      }
    }

    async function geocodeCity(cityName) {
      // Simple geocoding for common Israeli cities
      const cityCoordinates = {
        'tel aviv': { lat: 32.0853, lng: 34.7818 },
        'jerusalem': { lat: 31.7683, lng: 35.2137 },
        'haifa': { lat: 32.7940, lng: 34.9896 },
        'beer sheva': { lat: 31.2518, lng: 34.7913 },
        'eilat': { lat: 29.5577, lng: 34.9519 },
        'netanya': { lat: 32.3328, lng: 34.8600 },
        'ashdod': { lat: 31.8044, lng: 34.6500 },
        'rishon lezion': { lat: 31.9600, lng: 34.8000 },
        'petah tikva': { lat: 32.0853, lng: 34.8860 },
        'holon': { lat: 32.0167, lng: 34.7792 }
      };

      const normalizedCity = cityName.toLowerCase().trim();
      return cityCoordinates[normalizedCity] || null;
    }
  </script>
</body>
</html> 